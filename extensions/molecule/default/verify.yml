- name: Verify
  hosts: localhost
  become: true
  tasks:
    - name: Initialize role MySQL Oracle without actually running it
      ansible.builtin.include_role:
        name: ../../../../roles/mysql_oracle
        tasks_from: init

    - name: Check if MySQL Oracle GPG key exists
      stat:
        path: /tmp/RPM-GPG-KEY-mysql-2023
      register: rpm_gpg_key_mysql_2023

    - name: Assert that the MySQL Oracle GPG key exists
      assert:
        that:
          - rpm_gpg_key_mysql_2023.stat.exists
          -
    - name: Check if MySQL Oracle keyring exists
      stat:
        path: /usr/share/keyrings/mysql-apt-config.gpg
      register: mysql_apt_config_gpg

    - name: Assert that the MySQL Oracle keyring exists
      assert:
        that:
          - mysql_apt_config_gpg.stat.exists
          -
    - name: Check if MySQL Oracle APT repository file exists
      stat:
        path: /etc/apt/sources.list.d/mysql.list
      register: mysql_apt_repository

    - name: Assert that the MySQL Oracle APT repository file exists
      assert:
        that:
          - mysql_apt_repository.stat.exists

    - name: Check if MySQL root password file exists
      stat:
        path: /root/mysql-root-password.txt
      register: mysql_root_password

    - name: Assert that the MySQL root password file exists
      assert:
        that:
          - mysql_root_password.stat.exists

    - name: Check if MySQL server is up and running
      service:
        name: mysql
        state: started
      register: mysql_service

    - name: Assert that MySQL server is up and running
      assert:
        that:
          - mysql_service.state == 'started'